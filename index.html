
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookish Octo Robot</title>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // ðŸ”¹ Extract Token from URL and Store in localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get("token");
            if (token) {
                localStorage.setItem("github_token", token);
                window.history.replaceState({}, document.title, window.location.pathname); // Remove token from URL
            }

            // ðŸ”¹ Check Login Status
            const storedToken = localStorage.getItem("github_token");
            if (storedToken) {
                document.getElementById("login").style.display = "none";
                document.getElementById("logout").style.display = "block";
                document.getElementById("noteForm").style.display = "block";
            } else {
                document.getElementById("login").style.display = "block";
                document.getElementById("logout").style.display = "none";
                document.getElementById("noteForm").style.display = "none";
            }

            // ðŸ”¹ Fetch Approved Notes
            fetch("https://autumn-sky-4229.hiplitehehe.workers.dev/notes")
                .then(response => response.json())
                .then(notes => {
                    const noteList = document.getElementById("notes");
                    noteList.innerHTML = "";
                    notes.forEach(note => {
                        const li = document.createElement("li");
                        li.textContent = note.title;
                        noteList.appendChild(li);
                    });
                })
                .catch(error => console.error("Error fetching notes:", error));

            // ðŸ”¹ Handle Note Approval
            document.getElementById("approveForm").addEventListener("submit", (event) => {
                event.preventDefault();
                const noteTitle = document.getElementById("noteTitle").value.trim();
                if (!noteTitle) return alert("Note title cannot be empty!");

                fetch("https://autumn-sky-4229.hiplitehehe.workers.dev/approve", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${storedToken}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ title: noteTitle })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    location.reload(); // Refresh to show updated notes
                })
                .catch(error => alert("Failed to approve note!"));
            });
        });

        // ðŸ”¹ GitHub Login
        function login() {
            window.location.href = "https://autumn-sky-4229.hiplitehehe.workers.dev/login";
        }

        // ðŸ”¹ Logout
        function logout() {
            localStorage.removeItem("github_token");
            location.reload();
        }
    </script>
</head>
<body>
    <h1>Bookish Octo Robot</h1>
    
    <button id="login" onclick="login()">Login with GitHub</button>
    <button id="logout" onclick="logout()" style="display: none;">Logout</button>

    <h2>Approved Notes</h2>
    <ul id="notes">Loading...</ul>

    <div id="noteForm" style="display: none;">
        <h2>Approve a New Note</h2>
        <form id="approveForm">
            <input type="text" id="noteTitle" placeholder="Enter note title" required>
            <button type="submit">Approve</button>
        </form>
    </div>
</body>
</html>
